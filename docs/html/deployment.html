<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEPLOYMENT - sentinel</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background: #0d1117; color: #c9d1d9; display: flex; min-height: 100vh;
    }
    .sidebar {
      width: 260px; background: #161b22; border-right: 1px solid #30363d;
      padding: 1rem 0; position: fixed; top: 0; left: 0; bottom: 0; overflow-y: auto;
    }
    .sidebar-header {
      padding: 1rem 1.25rem; font-size: 1.1rem; font-weight: 700;
      border-bottom: 1px solid #30363d; margin-bottom: 0.5rem;
      color: #58a6ff;
    }
    .nav-item {
      display: block; padding: 0.5rem 1.25rem; color: #c9d1d9;
      text-decoration: none; font-size: 0.9rem;
      border-left: 3px solid transparent; transition: all 0.15s;
    }
    .nav-item:hover { background: #1f6feb33; }
    .nav-item.active {
      background: #1f6feb33; border-left-color: #58a6ff; font-weight: 600;
    }
    .content {
      margin-left: 260px; padding: 2rem 3rem; max-width: 900px; width: 100%;
    }
    h1 { font-size: 2rem; margin: 0.5em 0; border-bottom: 1px solid #30363d; padding-bottom: 0.3em; }
    h2 { font-size: 1.5rem; margin: 1.5em 0 0.5em; border-bottom: 1px solid #30363d; padding-bottom: 0.2em; }
    h3 { font-size: 1.25rem; margin: 1.2em 0 0.4em; }
    h4 { font-size: 1.1rem; margin: 1em 0 0.3em; }
    p { margin: 0.6em 0; line-height: 1.6; }
    a { color: #58a6ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    code {
      background: #1c2128; padding: 0.2em 0.4em; border-radius: 4px;
      font-family: "SFMono-Regular", Consolas, monospace; font-size: 0.85em;
    }
    pre {
      background: #1c2128; padding: 1em; border-radius: 8px;
      overflow-x: auto; margin: 1em 0; border: 1px solid #30363d;
    }
    pre code { background: none; padding: 0; }
    table {
      border-collapse: collapse; width: 100%; margin: 1em 0;
    }
    td, th {
      border: 1px solid #30363d; padding: 0.5em 0.75em; text-align: left;
    }
    tr:nth-child(even) { background: #1c2128; }
    ul { padding-left: 1.5em; margin: 0.5em 0; }
    li { margin: 0.3em 0; line-height: 1.5; }
    hr { border: none; border-top: 1px solid #30363d; margin: 2em 0; }
    img { border: 1px solid #30363d; }
    .mermaid { margin: 1.5em 0; }
    .footer {
      margin-top: 4em; padding-top: 1em; border-top: 1px solid #30363d;
      font-size: 0.8em; opacity: 0.6;
    }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .content { margin-left: 0; padding: 1rem; }
    }
  </style>
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "dark" });
  </script>
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">sentinel</div>
    <a href="architecture.html" class="nav-item">ARCHITECTURE</a>
          <a href="deployment.html" class="nav-item active">DEPLOYMENT</a>
          <a href="readme.html" class="nav-item">README</a>
          <a href="diagrams.html" class="nav-item">DIAGRAMS</a>
  </nav>
  <main class="content">
    <h1>DEPLOYMENT.md — Sentinel</h1>

<h2>Table of Contents</h2>

<ul><li><a href="#deploymentmd-sentinel">DEPLOYMENT.md — Sentinel</a></li>
</ul>  - <a href="#tldr">TL;DR</a>
<ul><li><a href="#navigate-to-httplocalhost3000">Navigate to http://localhost:3000</a></li>
</ul>  - <a href="#prerequisites">Prerequisites</a>
  - <a href="#step-by-step-setup">Step-by-Step Setup</a>
    - <a href="#1-clone-and-install">1. Clone and Install</a>
    - <a href="#2-configure-environment">2. Configure Environment</a>
    - <a href="#3-configure-ssh-access">3. Configure SSH Access</a>
    - <a href="#4-initialize-database">4. Initialize Database</a>
    - <a href="#5-start-the-server">5. Start the Server</a>
    - <a href="#6-verify-installation">6. Verify Installation</a>
<ul><li><a href="#expected-statusoktimestamp">Expected: {"status":"ok","timestamp":"..."}</a></li>
</ul>  - <a href="#environment-variables">Environment Variables</a>
  - <a href="#running-in-production">Running in Production</a>
    - <a href="#option-1-systemd-service-recommended-for-ubuntu">Option 1: systemd Service (Recommended for Ubuntu)</a>
    - <a href="#option-2-pm2-alternative">Option 2: PM2 (Alternative)</a>
    - <a href="#option-3-screentmux-quick-dirty">Option 3: Screen/tmux (Quick & Dirty)</a>
<ul><li><a href="#press-ctrla-then-d-to-detach">Press Ctrl+A, then D to detach</a></li>
</ul>  - <a href="#docker">Docker</a>
    - <a href="#dockerfile">Dockerfile</a>
<ul><li><a href="#install-build-dependencies-for-better-sqlite3">Install build dependencies for better-sqlite3</a></li>
<li><a href="#copy-package-files">Copy package files</a></li>
<li><a href="#install-dependencies">Install dependencies</a></li>
<li><a href="#copy-application">Copy application</a></li>
<li><a href="#create-volume-mount-points">Create volume mount points</a></li>
<li><a href="#expose-port">Expose port</a></li>
<li><a href="#set-environment">Set environment</a></li>
<li><a href="#health-check">Health check</a></li>
</ul>    - <a href="#docker-composeyml">docker-compose.yml</a>
    - <a href="#build-and-run">Build and Run</a>
  - <a href="#troubleshooting">Troubleshooting</a>
    - <a href="#port-already-in-use">Port Already in Use</a>
<ul><li><a href="#find-whats-using-port-3000">Find what's using port 3000</a></li>
<li><a href="#or">Or</a></li>
<li><a href="#kill-the-process">Kill the process</a></li>
<li><a href="#or-use-different-port">Or use different port</a></li>
</ul>    - <a href="#database-locked-error">Database Locked Error</a>
<ul><li><a href="#check-for-zombie-processes">Check for zombie processes</a></li>
<li><a href="#kill-old-instances">Kill old instances</a></li>
<li><a href="#restart-cleanly">Restart cleanly</a></li>
</ul>    - <a href="#ssh-connection-failures">SSH Connection Failures</a>
    - <a href="#missing-dependencies">Missing Dependencies</a>
<ul><li><a href="#rebuild-native-modules">Rebuild native modules</a></li>
<li><a href="#or-clean-install">Or clean install</a></li>
</ul>    - <a href="#permission-denied-on-database">Permission Denied on Database</a>
<ul><li><a href="#check-database-directory-permissions">Check database directory permissions</a></li>
<li><a href="#fix-ownership">Fix ownership</a></li>
<li><a href="#ensure-directory-exists">Ensure directory exists</a></li>
</ul>    - <a href="#high-memory-usage">High Memory Usage</a>
    - <a href="#dashboard-not-loading">Dashboard Not Loading</a>
<ul><li><a href="#systemd">systemd</a></li>
<li><a href="#pm2">PM2</a></li>
<li><a href="#direct">Direct</a></li>
<li><a href="#from-remote-machine">From remote machine</a></li>
<li><a href="#check-firewall">Check firewall</a></li>
</ul>    - <a href="#node-version-issues">Node Version Issues</a>
<ul><li><a href="#check-node-version">Check Node version</a></li>
<li><a href="#must-be-18x-or-higher">Must be 18.x or higher</a></li>
<li><a href="#install-correct-version">Install correct version:</a></li>
</ul>    - <a href="#cron-jobs-not-running">Cron Jobs Not Running</a>
<ul><li><a href="#check-cron-service-is-running">Check cron service is running</a></li>
<li><a href="#add-debug-logging-to-env">Add debug logging to .env:</a></li>
<li><a href="#restart-and-watch-logs">Restart and watch logs</a></li>
</ul>  - <a href="#related-documentation">Related Documentation</a>

<h2>TL;DR</h2>

<pre><code class="language-bash">git clone &lt;repository-url&gt; sentinel &amp;&amp; cd sentinel
<p>npm install</p>
<p>cp .env.example .env  # Edit DATABASE_PATH and SSH credentials</p>
<p>node src/server.js</p>
<h1>Navigate to http://localhost:3000</h1>
</code></pre>

<h2>Prerequisites</h2>

<table><tr><td>Requirement</td><td>Version</td><td>Installation</td></tr>
<tr><td>-------------</td><td>---------</td><td>--------------</td></tr>
<tr><td><strong>Node.js</strong></td><td>18.x or higher</td><td>https://nodejs.org/en/download/</td></tr>
<tr><td><strong>npm</strong></td><td>8.x or higher</td><td>Comes with Node.js</td></tr>
<tr><td><strong>SQLite3</strong></td><td>3.x</td><td>Pre-installed on most systems</td></tr>
<tr><td><strong>SSH Access</strong></td><td>-</td><td>SSH keys for monitored hosts</td></tr>
<tr><td><strong>Linux</strong></td><td>Ubuntu 20.04+ recommended</td><td>For production deployment</td></tr>
</table>
<strong>System Requirements:</strong>
<ul><li>512MB RAM minimum (1GB+ recommended)</li>
<li>100MB disk space minimum</li>
<li>Port 3000 available (or configure alternative)</li>
<li>SSH access to monitored VMs/hosts</li>
</ul>
<h2>Step-by-Step Setup</h2>

<h3>1. Clone and Install</h3>

<pre><code class="language-bash">git clone &lt;repository-url&gt; sentinel
<p>cd sentinel</p>
<p>npm install</p>
</code></pre>

<h3>2. Configure Environment</h3>

<pre><code class="language-bash">cp .env.example .env
<p>nano .env  # or use your preferred editor</p>
</code></pre>

<strong>Required Configuration:</strong>
<pre><code class="language-env">DATABASE_PATH=/path/to/sentinel.db
<p>PORT=3000</p>
<p>NODE_ENV=production</p>
</code></pre>

<h3>3. Configure SSH Access</h3>

<p>Create SSH credentials file:</p>

<pre><code class="language-bash">mkdir -p config
<p>nano config/hosts.json</p>
</code></pre>

<p>Example <code>config/hosts.json</code>:</p>
<pre><code class="language-json">{
  "hosts": [
    {
      "id": "vm1",
      "name": "Claudinator",
      "host": "192.168.1.100",
      "port": 22,
      "username": "forge",
      "privateKeyPath": "/home/forge/.ssh/id_rsa"
    }
  ]
}
</code></pre>

<h3>4. Initialize Database</h3>

<p>The database auto-initializes on first run, but you can verify:</p>

<pre><code class="language-bash">node -e "require('./src/services/storage').init()"
</code></pre>

<h3>5. Start the Server</h3>

<strong>Development:</strong>
<pre><code class="language-bash">npm run dev
</code></pre>

<strong>Production:</strong>
<pre><code class="language-bash">npm start
</code></pre>

<h3>6. Verify Installation</h3>

<pre><code class="language-bash">curl http://localhost:3000/health
<h1>Expected: {"status":"ok","timestamp":"..."}</h1>
</code></pre>

<p>Open browser: <code>http://localhost:3000</code></p>

<h2>Environment Variables</h2>

<table><tr><td>Variable</td><td>Description</td><td>Example</td><td>Required</td></tr>
<tr><td>----------</td><td>-------------</td><td>---------</td><td>----------</td></tr>
<tr><td><code>DATABASE_PATH</code></td><td>SQLite database file location</td><td><code>/var/lib/sentinel/sentinel.db</code></td><td>✅ Yes</td></tr>
<tr><td><code>PORT</code></td><td>HTTP server port</td><td><code>3000</code></td><td>❌ No (default: 3000)</td></tr>
<tr><td><code>NODE_ENV</code></td><td>Environment mode</td><td><code>production</code></td><td>❌ No (default: development)</td></tr>
<tr><td><code>LOG_LEVEL</code></td><td>Logging verbosity</td><td><code>info</code>, <code>debug</code>, <code>error</code></td><td>❌ No (default: info)</td></tr>
<tr><td><code>CRON_SCHEDULE</code></td><td>Monitoring interval</td><td><code><em>/5 </em> <em> </em> <em></code> (every 5 min)</td><td>❌ No (default: </em>/5)</td></tr>
<tr><td><code>SSH_TIMEOUT</code></td><td>SSH connection timeout (ms)</td><td><code>30000</code></td><td>❌ No (default: 30000)</td></tr>
<tr><td><code>MAX_CONCURRENT_CHECKS</code></td><td>Parallel host checks</td><td><code>5</code></td><td>❌ No (default: 3)</td></tr>
</table>
<strong>Optional Configuration Files:</strong>
<ul><li><code>config/hosts.json</code> — Monitored host definitions (required for monitoring)</li>
<li><code>config/alerts.json</code> — Alert rule configuration (optional)</li>
<li><code>config/backup-targets.json</code> — Backup monitoring targets (optional)</li>
</ul>
<h2>Running in Production</h2>

<h3>Option 1: systemd Service (Recommended for Ubuntu)</h3>

<p>Create service file:</p>

<pre><code class="language-bash">sudo nano /etc/systemd/system/sentinel.service
</code></pre>

<pre><code class="language-ini">[Unit]
<p>Description=Sentinel Infrastructure Monitor</p>
<p>After=network.target</p>

<p>[Service]</p>
<p>Type=simple</p>
<p>User=forge</p>
<p>WorkingDirectory=/opt/sentinel</p>
<p>ExecStart=/usr/bin/node /opt/sentinel/src/server.js</p>
<p>Restart=always</p>
<p>RestartSec=10</p>
<p>StandardOutput=append:/var/log/sentinel/access.log</p>
<p>StandardError=append:/var/log/sentinel/error.log</p>
<p>Environment=NODE_ENV=production</p>
<p>Environment=DATABASE_PATH=/var/lib/sentinel/sentinel.db</p>

<p>[Install]</p>
<p>WantedBy=multi-user.target</p>
</code></pre>

<strong>Setup and start:</strong>

<pre><code class="language-bash">sudo mkdir -p /var/log/sentinel /var/lib/sentinel
<p>sudo chown forge:forge /var/log/sentinel /var/lib/sentinel</p>
<p>sudo systemctl daemon-reload</p>
<p>sudo systemctl enable sentinel</p>
<p>sudo systemctl start sentinel</p>
<p>sudo systemctl status sentinel</p>
</code></pre>

<strong>View logs:</strong>
<pre><code class="language-bash">sudo journalctl -u sentinel -f
</code></pre>

<h3>Option 2: PM2 (Alternative)</h3>

<pre><code class="language-bash">npm install -g pm2
<p>pm2 start src/server.js --name sentinel</p>
<p>pm2 save</p>
<p>pm2 startup  # Follow instructions to enable on boot</p>
</code></pre>

<strong>PM2 Commands:</strong>
<pre><code class="language-bash">pm2 status
<p>pm2 logs sentinel</p>
<p>pm2 restart sentinel</p>
<p>pm2 stop sentinel</p>
</code></pre>

<h3>Option 3: Screen/tmux (Quick & Dirty)</h3>

<pre><code class="language-bash">screen -S sentinel
<p>npm start</p>
<h1>Press Ctrl+A, then D to detach</h1>
<p>screen -r sentinel  # To reattach</p>
</code></pre>

<h2>Docker</h2>

<h3>Dockerfile</h3>

<pre><code class="language-dockerfile">FROM node:18-alpine

<h1>Install build dependencies for better-sqlite3</h1>
<p>RUN apk add --no-cache python3 make g++ sqlite</p>

<p>WORKDIR /app</p>

<h1>Copy package files</h1>
<p>COPY package*.json ./</p>

<h1>Install dependencies</h1>
<p>RUN npm ci --only=production</p>

<h1>Copy application</h1>
<p>COPY . .</p>

<h1>Create volume mount points</h1>
<p>VOLUME ["/app/data", "/app/config"]</p>

<h1>Expose port</h1>
<p>EXPOSE 3000</p>

<h1>Set environment</h1>
<p>ENV NODE_ENV=production</p>
<p>ENV DATABASE_PATH=/app/data/sentinel.db</p>

<h1>Health check</h1>
<p>HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \</p>
  CMD node -e "require('http').get('http://localhost:3000/health', (r) =&gt; process.exit(r.statusCode === 200 ? 0 : 1))"

<p>CMD ["node", "src/server.js"]</p>
</code></pre>

<h3>docker-compose.yml</h3>

<pre><code class="language-yaml">version: '3.8'

<p>services:</p>
  sentinel:
    build: .
    container_name: sentinel
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
      - ./config:/app/config
      - ~/.ssh:/root/.ssh:ro  # SSH keys for host monitoring
    environment:
      - NODE_ENV=production
      - DATABASE_PATH=/app/data/sentinel.db
      - PORT=3000
    networks:
      - sentinel-net

<p>networks:</p>
  sentinel-net:
    driver: bridge
</code></pre>

<h3>Build and Run</h3>

<pre><code class="language-bash">docker build -t sentinel:latest .
<p>docker run -d \</p>
  --name sentinel \
  -p 3000:3000 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/config:/app/config \
  -v ~/.ssh:/root/.ssh:ro \
  sentinel:latest
</code></pre>

<strong>With docker-compose:</strong>
<pre><code class="language-bash">docker-compose up -d
<p>docker-compose logs -f sentinel</p>
<p>docker-compose restart sentinel</p>
</code></pre>

<h2>Troubleshooting</h2>

<h3>Port Already in Use</h3>

<strong>Error:</strong> <code>EADDRINUSE: address already in use :::3000</code>

<pre><code class="language-bash"># Find what's using port 3000
<p>sudo lsof -i :3000</p>
<h1>Or</h1>
<p>sudo netstat -tlnp | grep 3000</p>

<h1>Kill the process</h1>
<p>sudo kill -9 &lt;PID&gt;</p>

<h1>Or use different port</h1>
<p>PORT=3001 npm start</p>
</code></pre>

<h3>Database Locked Error</h3>

<strong>Error:</strong> <code>SQLITE_BUSY: database is locked</code>

<pre><code class="language-bash"># Check for zombie processes
<p>ps aux | grep node</p>

<h1>Kill old instances</h1>
<p>pkill -f "node.*sentinel"</p>

<h1>Restart cleanly</h1>
<p>npm start</p>
</code></pre>

<h3>SSH Connection Failures</h3>

<strong>Error:</strong> <code>Error: All configured authentication methods failed</code>

<strong>Fixes:</strong>
<p>1. Verify SSH key permissions:</p>
<pre><code class="language-bash">chmod 600 ~/.ssh/id_rsa
<p>chmod 700 ~/.ssh</p>
</code></pre>

<p>2. Test SSH manually:</p>
<pre><code class="language-bash">ssh -i ~/.ssh/id_rsa forge@192.168.1.100
</code></pre>

<p>3. Check <code>config/hosts.json</code> paths are absolute</p>
<p>4. Ensure user has SSH access to target hosts</p>

<h3>Missing Dependencies</h3>

<strong>Error:</strong> <code>Cannot find module 'better-sqlite3'</code>

<pre><code class="language-bash"># Rebuild native modules
<p>npm rebuild better-sqlite3</p>

<h1>Or clean install</h1>
<p>rm -rf node_modules package-lock.json</p>
<p>npm install</p>
</code></pre>

<h3>Permission Denied on Database</h3>

<strong>Error:</strong> <code>SQLITE_CANTOPEN: unable to open database file</code>

<pre><code class="language-bash"># Check database directory permissions
<p>ls -la /var/lib/sentinel/</p>

<h1>Fix ownership</h1>
<p>sudo chown -R forge:forge /var/lib/sentinel</p>

<h1>Ensure directory exists</h1>
<p>mkdir -p $(dirname $DATABASE_PATH)</p>
</code></pre>

<h3>High Memory Usage</h3>

<strong>Symptoms:</strong> Node process consuming excessive memory

<strong>Fixes:</strong>
<p>1. Limit concurrent checks in <code>.env</code>:</p>
<pre><code class="language-env">MAX_CONCURRENT_CHECKS=2
</code></pre>

<p>2. Increase check interval:</p>
<pre><code class="language-env">CRON_SCHEDULE=<em>/10 </em> <em> </em> *  # Every 10 minutes instead of 5
</code></pre>

<p>3. Set Node memory limit:</p>
<pre><code class="language-bash">NODE_OPTIONS="--max-old-space-size=512" npm start
</code></pre>

<h3>Dashboard Not Loading</h3>

<strong>Checks:</strong>
<p>1. Server is running:</p>
<pre><code class="language-bash">curl http://localhost:3000/health
</code></pre>

<p>2. Check logs:</p>
<pre><code class="language-bash"># systemd
<p>sudo journalctl -u sentinel -n 50</p>

<h1>PM2</h1>
<p>pm2 logs sentinel</p>

<h1>Direct</h1>
<p>tail -f /var/log/sentinel/error.log</p>
</code></pre>

<p>3. Verify port accessibility:</p>
<pre><code class="language-bash"># From remote machine
<p>curl http://&lt;server-ip&gt;:3000/health</p>

<h1>Check firewall</h1>
<p>sudo ufw status</p>
<p>sudo ufw allow 3000/tcp</p>
</code></pre>

<h3>Node Version Issues</h3>

<strong>Error:</strong> <code>SyntaxError: Unexpected token '?.'</code> or similar

<pre><code class="language-bash"># Check Node version
<p>node --version</p>

<h1>Must be 18.x or higher</h1>
<h1>Install correct version:</h1>
<p>curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -</p>
<p>sudo apt-get install -y nodejs</p>
</code></pre>

<h3>Cron Jobs Not Running</h3>

<strong>Symptom:</strong> Monitoring data not updating

<strong>Debug:</strong>
<pre><code class="language-bash"># Check cron service is running
<h1>Add debug logging to .env:</h1>
<p>LOG_LEVEL=debug</p>

<h1>Restart and watch logs</h1>
<p>npm start</p>
</code></pre>

<strong>Verify cron schedule:</strong>
<pre><code class="language-javascript">// Test in Node console
<p>node -e "console.log(require('node-cron').validate('<em>/5 </em> <em> </em> *'))"</p>
<p>// Should print: true</p>
</code></pre>

<hr>

<strong>Need Help?</strong>
<ul><li>Check logs first: <code>sudo journalctl -u sentinel -n 100</code></li>
<li>Verify prerequisites are met</li>
<li>Test SSH connections manually</li>
<li>Review <code>config/hosts.json</code> syntax</li>
<li>Ensure database path is writable</li>
</ul><hr>

<h2>Related Documentation</h2>

<ul><li><a href="README.md">Readme</a></li>
<li><a href="ARCHITECTURE.md">Architecture</a></li>
</ul>
    <div class="footer">
      Generated by Athena &mdash; &copy; 2026 TheForge, LLC
    </div>
  </main>
</body>
</html>